---
- name: Install R packages into the system library
  block:
  - name: Handle environment creation
    block:
    - name: Install tidyverse system-dependencies
    # using Ansible's "apt:" function is nicer than "command:", but I was to lazy to figure out how it works for fixed packages
      command: "apt install --yes libxml2-dev libcurl4-openssl-dev libssl-dev"    
    - name: Install R-packages globally
      command: "Rscript -e \"install.packages(commandArgs(trainlingOnly=TRUE), lib='/usr/lib/R/library')\" {{item}}"
      with_items: "{{req.r}}"       
    when: req.r is defined